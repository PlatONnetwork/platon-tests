import allure
import pytest
from eth_account import Account
from platon_aide.contract import Contract
# from platon_utils import to_bech32_address
from web3 import Web3, HTTPProvider

from setting import setting

rpc = 'http://10.2.13.21:8545'

web3 = Web3(HTTPProvider(rpc))
contract = Contract(web3)
false = False
true = True

abi = [{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"txHash","type":"bytes32"},{"indexed":true,"internalType":"address","name":"receiveAddress","type":"address"},{"indexed":false,"internalType":"string","name":"symbol","type":"string"},{"indexed":false,"internalType":"address","name":"tokenAddress","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"lockFee","type":"uint256"}],"name":"AssetLockRollback","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"localAddress","type":"address"},{"indexed":true,"internalType":"address","name":"remoteAddress","type":"address"},{"indexed":false,"internalType":"string","name":"symbol","type":"string"},{"indexed":false,"internalType":"address","name":"tokenAddress","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"lockFee","type":"uint256"}],"name":"AssetLocked","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"txHash","type":"bytes32"},{"indexed":true,"internalType":"address","name":"localAddress","type":"address"},{"indexed":true,"internalType":"address","name":"remoteAddress","type":"address"},{"indexed":false,"internalType":"string","name":"symbol","type":"string"},{"indexed":false,"internalType":"address","name":"tokenAddress","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"releaseFee","type":"uint256"}],"name":"AssetReleased","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"oldIncomeAddress","type":"address"},{"indexed":false,"internalType":"address","name":"newIncomeAddress","type":"address"}],"name":"IncomeAddressChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"incomeAddress","type":"address"},{"indexed":false,"internalType":"string","name":"symbol","type":"string"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"IncomeTransOut","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"oldMonitor","type":"address"},{"indexed":true,"internalType":"address","name":"newMonitor","type":"address"}],"name":"MonitorChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"symbol","type":"string"},{"indexed":false,"internalType":"uint256","name":"oldMaxCap","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"newMaxCap","type":"uint256"}],"name":"SingleMaxCapChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"symbol","type":"string"},{"indexed":false,"internalType":"uint256","name":"oldMinCap","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"newMinCap","type":"uint256"}],"name":"SingleMinCapChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"symbol","type":"string"},{"indexed":false,"internalType":"uint256","name":"oldFee","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"fee","type":"uint256"}],"name":"TokenAcrossFeeSetted","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"symbol","type":"string"},{"indexed":false,"internalType":"uint256","name":"oldCap","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"newCap","type":"uint256"}],"name":"TokenCapChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"symbol","type":"string"},{"indexed":false,"internalType":"address","name":"contractAddress","type":"address"},{"indexed":false,"internalType":"uint256","name":"cap","type":"uint256"}],"name":"TokenRegistered","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"oldWitness","type":"address"},{"indexed":true,"internalType":"address","name":"newWitness","type":"address"}],"name":"WitnessChanged","type":"event"},{"inputs":[],"name":"VALID_REMOTE_ADDRESS_LENGTH","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getSwitch","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"incomeAddress","outputs":[{"internalType":"address payable","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"isMonitor","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"isOwner","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"isWitness","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"monitor","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"nativeSymbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"rollbackNonces","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_newMonitor","type":"address"}],"name":"setMonitor","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bool","name":"_newSwitch","type":"bool"}],"name":"setSwitch","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_newWitness","type":"address"}],"name":"setWitness","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"witness","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"stateMutability":"payable","type":"receive"},{"inputs":[],"name":"initialize","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_newSymbol","type":"string"}],"name":"setNativeSymbol","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_symbol","type":"string"}],"name":"getTokenContract","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"_symbol","type":"string"}],"name":"getTokenCap","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"_symbol","type":"string"},{"internalType":"uint256","name":"_newCap","type":"uint256"}],"name":"setTokenCap","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_symbol","type":"string"}],"name":"getSingleMinCap","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"_symbol","type":"string"},{"internalType":"uint256","name":"_newSingleMinCap","type":"uint256"}],"name":"setSingleMinCap","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_symbol","type":"string"}],"name":"getSingleMaxCap","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"_symbol","type":"string"},{"internalType":"uint256","name":"_newSingleMaxCap","type":"uint256"}],"name":"setSingleMaxCap","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_symbol","type":"string"}],"name":"getTokenAcrossFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"_symbol","type":"string"},{"internalType":"uint256","name":"_newTokenAcrossFee","type":"uint256"}],"name":"setTokenAcrossFee","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_symbol","type":"string"}],"name":"getTokenAcrossIncome","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address payable","name":"_incomeAddress","type":"address"}],"name":"setIncomeAddress","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_symbol","type":"string"},{"internalType":"address","name":"_contract","type":"address"},{"internalType":"uint256","name":"_cap","type":"uint256"}],"name":"regTokenContract","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_remoteAddress","type":"address"},{"internalType":"string","name":"_symbol","type":"string"},{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"lockAsset","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"_txHash","type":"bytes32"},{"internalType":"address payable","name":"_localAddress","type":"address"},{"internalType":"address","name":"_remoteAddress","type":"address"},{"internalType":"string","name":"_symbol","type":"string"},{"internalType":"uint256","name":"_amount","type":"uint256"},{"internalType":"uint256","name":"_releaseFee","type":"uint256"}],"name":"releaseAsset","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"_txHash","type":"bytes32"},{"internalType":"address payable","name":"_receiveAddress","type":"address"},{"internalType":"string","name":"_symbol","type":"string"},{"internalType":"uint256","name":"_amount","type":"uint256"},{"internalType":"uint256","name":"_lockFee","type":"uint256"}],"name":"rollBackToken","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_symbol","type":"string"}],"name":"withdrawIncome","outputs":[],"stateMutability":"nonpayable","type":"function"}]
bytecode = '608060405234801561001057600080fd5b506134b2806100206000396000f3fe6080604052600436106101f25760003560e01c80637fedad551161010d57806393fbd51f116100a0578063d2c46e1a1161006f578063d2c46e1a146105ef578063e7ba47de1461060f578063f2fde38b1461062f578063f415071c1461064f578063fce14eff1461066f57600080fd5b806393fbd51f1461057a57806397cefc4c1461059a5780639a40cc38146105ba578063b283d7fd146105cf57600080fd5b80638bd89af3116100dc5780638bd89af3146104fc5780638da5cb5b1461051c5780638f32d59b1461053a5780638f7247a41461055a57600080fd5b80637fedad55146104925780638129fc1c146104b457806382a43fbc146104c957806382b65ea4146104e957600080fd5b8063374bfb65116101855780635cd82390116101545780635cd82390146104135780635eef33f7146104335780636b662698146104535780636fb7575c1461047357600080fd5b8063374bfb6514610391578063381c4fce146103b157806339046e8b146103d15780634a715cf1146103f357600080fd5b80632a32db58116101c15780632a32db58146102ef5780632fc15d341461030f5780633241992a1461032f57806334b75a0c1461036157600080fd5b80630bc14f8b1461024957806316be8f721461026b578063217e24661461029e57806321c75207146102cf57600080fd5b366102445760405162461bcd60e51b815260206004820181905260248201527f4343426173653a2063616c6c204c6f636b417373657420696e7374656164212160448201526064015b60405180910390fd5b600080fd5b34801561025557600080fd5b50610269610264366004612c74565b61068f565b005b34801561027757600080fd5b5061028b610286366004612e17565b61080d565b6040519081526020015b60405180910390f35b3480156102aa57600080fd5b503360009081526034602052604090205460ff165b6040519015158152602001610295565b3480156102db57600080fd5b506102696102ea366004612da9565b610839565b3480156102fb57600080fd5b5061028b61030a366004612e17565b610cc1565b34801561031b57600080fd5b5061028b61032a366004612e17565b610cd5565b34801561033b57600080fd5b506036546001600160a01b03165b6040516001600160a01b039091168152602001610295565b34801561036d57600080fd5b506102bf61037c366004612f02565b603a6020526000908152604090205460ff1681565b34801561039d57600080fd5b506102696103ac366004612c74565b610ce9565b3480156103bd57600080fd5b506103496103cc366004612e17565b610d6d565b3480156103dd57600080fd5b506103e6610da2565b6040516102959190613025565b3480156103ff57600080fd5b5061026961040e366004612eb6565b610e04565b34801561041f57600080fd5b5061026961042e366004612c74565b610ebb565b34801561043f57600080fd5b5061026961044e366004612eb6565b610f41565b34801561045f57600080fd5b5061028b61046e366004612e17565b610fea565b34801561047f57600080fd5b50603654600160a01b900460ff166102bf565b34801561049e57600080fd5b506104a7610ffe565b6040516102959190613127565b3480156104c057600080fd5b5061026961108c565b3480156104d557600080fd5b506102696104e4366004612d27565b611169565b6102696104f7366004612c91565b611261565b34801561050857600080fd5b50603f54610349906001600160a01b031681565b34801561052857600080fd5b506033546001600160a01b0316610349565b34801561054657600080fd5b506033546001600160a01b031633146102bf565b34801561056657600080fd5b50610269610575366004612eb6565b611aad565b34801561058657600080fd5b50610269610595366004612e17565b611b56565b3480156105a657600080fd5b506102696105b5366004612ced565b611ec8565b3480156105c657600080fd5b5061028b602a81565b3480156105db57600080fd5b506102696105ea366004612eb6565b611f65565b3480156105fb57600080fd5b5061026961060a366004612e59565b61200e565b34801561061b57600080fd5b5061028b61062a366004612e17565b6122db565b34801561063b57600080fd5b5061026961064a366004612c74565b6122ef565b34801561065b57600080fd5b5061026961066a366004612e17565b612322565b34801561067b57600080fd5b506036546001600160a01b031633146102bf565b6033546001600160a01b031633146106b95760405162461bcd60e51b815260040161023b90613221565b60355460011461070b5760405162461bcd60e51b815260206004820152601b60248201527f7769746e657373206c656e677468206d75737420657175616c20310000000000604482015260640161023b565b806001600160a01b0316603560008154811061072957610729613443565b60009182526020822001546040516001600160a01b03909116917f6b574ca7dba9fa8572b74f206089d9626b4494e54cc4eaf180f739275642993e91a360346000603560008154811061077e5761077e613443565b60009182526020808320909101546001600160a01b0390811684528382019490945260409283018220805460ff199081169091559385168252603490529081208054909216600117909155603580548392906107dc576107dc613443565b9060005260206000200160006101000a8154816001600160a01b0302191690836001600160a01b0316021790555050565b6000603d8383604051610821929190612f79565b90815260200160405180910390205490505b92915050565b6002600154141561085c5760405162461bcd60e51b815260040161023b90613256565b60026001553360009081526034602052604090205460ff166108905760405162461bcd60e51b815260040161023b90613191565b603654600160a01b900460ff1615156001146108be5760405162461bcd60e51b815260040161023b9061315a565b80603e85856040516108d1929190612f79565b908152602001604051809103902054101561093f5760405162461bcd60e51b815260206004820152602860248201527f496e73756666696369656e7420696e636f6d652062616c616e636520746f20726044820152676f6c6c6261636b2160c01b606482015260840161023b565b60008061094c838561328d565b9050610a186037805461095e906133f2565b80601f016020809104026020016040519081016040528092919081815260200182805461098a906133f2565b80156109d75780601f106109ac576101008083540402835291602001916109d7565b820191906000526020600020905b8154815290600101906020018083116109ba57829003601f168201915b505050505087878080601f01602080910402602001604051908101604052809392919081815260200183838082843760009201919091525061235d92505050565b15610ab85780471015610a7c5760405162461bcd60e51b815260206004820152602660248201527f496e73756666696369656e74206e617469766520617373657420746f20726f6c6044820152656c6261636b2160d01b606482015260840161023b565b6040516001600160a01b0388169082156108fc029083906000818181858888f19350505050158015610ab2573d6000803e3d6000fd5b50610c19565b60388686604051610aca929190612f79565b908152604051908190036020019020546001600160a01b0316915081610b2e5760405162461bcd60e51b815260206004820152601960248201527853796d626f6c206861736e277420726567697374657265642160381b604482015260640161023b565b6040516370a0823160e01b815230600482015281906001600160a01b038416906370a082319060240160206040518083038186803b158015610b6f57600080fd5b505afa158015610b83573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610ba79190612f1b565b1015610c055760405162461bcd60e51b815260206004820152602760248201527f496e73756666696369656e7420746f6b656e2062616c616e636520746f20726f6044820152666c6c6261636b2160c81b606482015260840161023b565b610c196001600160a01b03831688836123b6565b610c4583603e8888604051610c2f929190612f79565b9081526040519081900360200190205490612419565b603e8787604051610c57929190612f79565b908152602001604051809103902081905550866001600160a01b0316887f6531b65050e02c97ac1f1173f03db69914da5de93bd89c980104ea84907ff31d8888868989604051610cab9594939291906130a2565b60405180910390a3505060018055505050505050565b600060398383604051610821929190612f79565b6000603e8383604051610821929190612f79565b6033546001600160a01b03163314610d135760405162461bcd60e51b815260040161023b90613221565b603f80546001600160a01b038381166001600160a01b031983168117909355604051928352169081907feeaaf9f29884d229c89c19773badf3652a36e775aa7b9d96178f648961ee33d19060200160405180910390a25050565b600060388383604051610d81929190612f79565b908152604051908190036020019020546001600160a01b0316905092915050565b60606035805480602002602001604051908101604052809291908181526020018280548015610dfa57602002820191906000526020600020905b81546001600160a01b03168152600190910190602001808311610ddc575b5050505050905090565b6033546001600160a01b03163314610e2e5760405162461bcd60e51b815260040161023b90613221565b6000603c8484604051610e42929190612f79565b908152602001604051809103902054905081603c8585604051610e66929190612f79565b9081526020016040518091039020819055507f4feaa80061a523a917c66d9b4eeb21dd7453d42e320a7c18480c590a00d40b5784848385604051610ead94939291906130dc565b60405180910390a150505050565b6033546001600160a01b03163314610ee55760405162461bcd60e51b815260040161023b90613221565b6036546040516001600160a01b038084169216907fe0dc6d2205ca24ba49ce09888e88005fb69117905756cc28f18fea967ea3354e90600090a3603680546001600160a01b0319166001600160a01b0392909216919091179055565b6033546001600160a01b03163314610f6b5760405162461bcd60e51b815260040161023b90613221565b6000603b8484604051610f7f929190612f79565b908152602001604051809103902054905081603b8585604051610fa3929190612f79565b9081526020016040518091039020819055507ff9c737b9c17fcc99f3ef50be7ba2a32398c752027e04823934a44188f7b9b32a84848385604051610ead94939291906130dc565b6000603b8383604051610821929190612f79565b6037805461100b906133f2565b80601f0160208091040260200160405190810160405280929190818152602001828054611037906133f2565b80156110845780601f1061105957610100808354040283529160200191611084565b820191906000526020600020905b81548152906001019060200180831161106757829003601f168201915b505050505081565b600054610100900460ff166110a75760005460ff16156110ab565b303b155b6110c75760405162461bcd60e51b815260040161023b906131d3565b600054610100900460ff161580156110e9576000805461ffff19166101011790555b6110f161242c565b6040805180820190915260038082526208aa8960eb1b602090920191825261111b91603791612b1e565b506111286012600a6132e8565b611133906064613390565b603960376040516111449190612f89565b908152604051908190036020019020558015611166576000805461ff00191690555b50565b6002600154141561118c5760405162461bcd60e51b815260040161023b90613256565b60026001553360009081526034602052604090205460ff166111c05760405162461bcd60e51b815260040161023b90613191565b603654600160a01b900460ff1615156001146111ee5760405162461bcd60e51b815260040161023b9061315a565b60006111fd8786868686612564565b9050856001600160a01b0316876001600160a01b0316897f03e2cf6d3c84f4478dc3d3c13584b889317021c57975bde443d33b710c30369d888886898960405161124b9594939291906130a2565b60405180910390a4505060018055505050505050565b600260015414156112845760405162461bcd60e51b815260040161023b90613256565b60026001908155603654600160a01b900460ff161515146112b75760405162461bcd60e51b815260040161023b9061315a565b6001600160a01b0384166113175760405162461bcd60e51b815260206004820152602160248201527f496e76616c6964206c656e677468206f662072656d6f746520616464726573736044820152602160f81b606482015260840161023b565b603b8383604051611329929190612f79565b9081526020016040518091039020548110156113925760405162461bcd60e51b815260206004820152602260248201527f4c657373207468616e20746f6b656e2073696e676c65206c6f636b206c696d69604482015261742160f01b606482015260840161023b565b603c83836040516113a4929190612f79565b90815260200160405180910390205481111561140d5760405162461bcd60e51b815260206004820152602260248201527f4d6f7265207468616e20746f6b656e2073696e676c65206c6f636b206c696d69604482015261742160f01b606482015260840161023b565b600081116114545760405162461bcd60e51b815260206004820152601460248201527343616e2774206c6f636b203020616d6f756e742160601b604482015260640161023b565b603d8383604051611466929190612f79565b90815260200160405180910390205481116114d25760405162461bcd60e51b815260206004820152602660248201527f4c6f636b20616d6f756e74206d757374206d6f7265207468616e206163726f7360448201526573206665652160d01b606482015260840161023b565b600061159e603780546114e4906133f2565b80601f0160208091040260200160405190810160405280929190818152602001828054611510906133f2565b801561155d5780601f106115325761010080835404028352916020019161155d565b820191906000526020600020905b81548152906001019060200180831161154057829003601f168201915b505050505085858080601f01602080910402602001604051908101604052809392919081815260200183838082843760009201919091525061235d92505050565b15611681573482811461160c5760405162461bcd60e51b815260206004820152603060248201527f4c6f636b206e617469766520616d6f756e7420646f206e6f7420657175616c2060448201526f746f2061637475616c2076616c75652160801b606482015260840161023b565b6039603760405161161d9190612f89565b90815260200160405180910390205447111561167b5760405162461bcd60e51b815260206004820152601f60248201527f457863656564206e6174697665206173736574206c6f636b206c696d69742100604482015260640161023b565b50611997565b60388484604051611693929190612f79565b908152604051908190036020019020546001600160a01b03169050806117055760405162461bcd60e51b815260206004820152602160248201527f546f6b656e20636f6e7472616374206861736e277420726567697374657265646044820152602160f81b606482015260840161023b565b6040516370a0823160e01b815233600482015282906001600160a01b038316906370a082319060240160206040518083038186803b15801561174657600080fd5b505afa15801561175a573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061177e9190612f1b565b10156117c45760405162461bcd60e51b8152602060048201526015602482015274496e73756666696369656e742062616c616e63652160581b604482015260640161023b565b604051636eb1769f60e11b815233600482015230602482015282906001600160a01b0383169063dd62ed3e9060440160206040518083038186803b15801561180b57600080fd5b505afa15801561181f573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906118439190612f1b565b10156118915760405162461bcd60e51b815260206004820152601760248201527f496e73756666696369656e7420616c6c6f77616e636521000000000000000000604482015260640161023b565b603984846040516118a3929190612f79565b908152604051908190036020018120546370a0823160e01b8252306004830152906119349084906001600160a01b038516906370a082319060240160206040518083038186803b1580156118f657600080fd5b505afa15801561190a573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061192e9190612f1b565b906127c1565b11156119825760405162461bcd60e51b815260206004820152601860248201527f45786365656420746f6b656e206c6f636b206c696d6974210000000000000000604482015260640161023b565b6119976001600160a01b0382163330856127cd565b6119e3603d85856040516119ac929190612f79565b908152602001604051809103902054603e86866040516119cd929190612f79565b90815260405190819003602001902054906127c1565b603e85856040516119f5929190612f79565b908152602001604051809103902081905550846001600160a01b0316336001600160a01b03167ff6d23a18e4a3810c1f6075cf1fbf54211295297216841bee6c3e27f950c7e9d3868685611a6b603d8b8b604051611a54929190612f79565b908152604051908190036020019020548990612419565b603d8b8b604051611a7d929190612f79565b90815260405190819003602001812054611a9a95949392916130a2565b60405180910390a3505060018055505050565b6033546001600160a01b03163314611ad75760405162461bcd60e51b815260040161023b90613221565b600060398484604051611aeb929190612f79565b90815260200160405180910390205490508160398585604051611b0f929190612f79565b9081526020016040518091039020819055507fbc8581f422265de272f7274863bdbb341f4f80505c20877b68a2f433bc76359e84848385604051610ead94939291906130dc565b60026001541415611b795760405162461bcd60e51b815260040161023b90613256565b6002600155603f546001600160a01b03163314611be25760405162461bcd60e51b815260206004820152602160248201527f43616c6c6572206973206e6f742074686520696e636f6d6520616464726573736044820152602160f81b606482015260840161023b565b603f546001600160a01b0316611c3a5760405162461bcd60e51b815260206004820152601a60248201527f496e76616c6964206f6620696e636f6d65206164647265737321000000000000604482015260640161023b565b6000603e8383604051611c4e929190612f79565b908152602001604051809103902054905060008111611caf5760405162461bcd60e51b815260206004820152601d60248201527f4e6f20656e6f75676820696e636f6d6520746f20776974686472617721000000604482015260640161023b565b611d7960378054611cbf906133f2565b80601f0160208091040260200160405190810160405280929190818152602001828054611ceb906133f2565b8015611d385780601f10611d0d57610100808354040283529160200191611d38565b820191906000526020600020905b815481529060010190602001808311611d1b57829003601f168201915b505050505084848080601f01602080910402602001604051908101604052809392919081815260200183838082843760009201919091525061235d92505050565b15611dbe57603f546040516001600160a01b039091169082156108fc029083906000818181858888f19350505050158015611db8573d6000803e3d6000fd5b50611e52565b600060388484604051611dd2929190612f79565b908152604051908190036020019020546001600160a01b0316905080611e365760405162461bcd60e51b815260206004820152601960248201527853796d626f6c206861736e277420726567697374657265642160381b604482015260640161023b565b603f54611e50906001600160a01b038381169116846123b6565b505b6000603e8484604051611e66929190612f79565b90815260405190819003602001812091909155603f546001600160a01b0316907f7b9edd8bd9420ae8cf5d7906d28f4dd297ef728b03f8562ce88842f5838c351290611eb790869086908690613103565b60405180910390a250506001805550565b6036546001600160a01b0316331480611eeb57506033546001600160a01b031633145b611f475760405162461bcd60e51b815260206004820152602760248201527f4343426173653a2063616c6c6572206973206e6f74206d6f6e69746f72206f72604482015266206f776e65722160c81b606482015260840161023b565b60368054911515600160a01b0260ff60a01b19909216919091179055565b6033546001600160a01b03163314611f8f5760405162461bcd60e51b815260040161023b90613221565b6000603d8484604051611fa3929190612f79565b908152602001604051809103902054905081603d8585604051611fc7929190612f79565b9081526020016040518091039020819055507ff2c36713dad8d3692cac33cbba7daa83285e9f72eb2ffdacfaaef0609339c7f584848385604051610ead94939291906130dc565b6033546001600160a01b031633146120385760405162461bcd60e51b815260040161023b90613221565b82158015906120475750601483105b6120aa5760405162461bcd60e51b815260206004820152602e60248201527f53796d626f6c2063616e2774206265206e756c6c206f72206c6f6e676572207460448201526d68616e20313920737472696e672160901b606482015260840161023b565b6120ba603780546114e4906133f2565b156121075760405162461bcd60e51b815260206004820152601a60248201527f4e61746976652073796d626f6c20697320726573657276656421000000000000604482015260640161023b565b6001600160a01b0382163b61215e5760405162461bcd60e51b815260206004820152601960248201527f49736e2774206120636f6e747261637420616464726573732100000000000000604482015260640161023b565b60006001600160a01b03166038858560405161217b929190612f79565b908152604051908190036020019020546001600160a01b0316146121fe5760405162461bcd60e51b815260206004820152603460248201527f546f6b656e20636f6e747261637420776974682073616d652073796d626f6c20604482015273686173206265656e20726567697374657265642160601b606482015260840161023b565b8160388585604051612211929190612f79565b908152602001604051809103902060006101000a8154816001600160a01b0302191690836001600160a01b031602179055508060398585604051612256929190612f79565b9081526020016040518091039020819055507f4f26da311bd4d456b737a6ad354fa72b40329c4b6537ff6bf223711e4a1b15418484848460405161229d9493929190613072565b60405180910390a17fbc8581f422265de272f7274863bdbb341f4f80505c20877b68a2f433bc76359e8484600084604051610ead94939291906130dc565b6000603c8383604051610821929190612f79565b6033546001600160a01b031633146123195760405162461bcd60e51b815260040161023b90613221565b6111668161280b565b6033546001600160a01b0316331461234c5760405162461bcd60e51b815260040161023b90613221565b61235860378383612ba2565b505050565b6000816040516020016123709190612f5d565b60405160208183030381529060405280519060200120836040516020016123979190612f5d565b6040516020818303038152906040528051906020012014905092915050565b6040516001600160a01b03831660248201526044810182905261235890849063a9059cbb60e01b906064015b60408051601f198184030181529190526020810180516001600160e01b03166001600160e01b0319909316929092179091526128cb565b600061242582846133af565b9392505050565b600054610100900460ff166124475760005460ff161561244b565b303b155b6124675760405162461bcd60e51b815260040161023b906131d3565b600054610100900460ff16158015612489576000805461ffff19166101011790555b603380546001600160a01b0319908116339081178355600081815260346020526040808220805460ff1916600190811790915560358054918201815583527fcfa4bec1d3298408bb5afcfcd9c430549c5b31f8aa5c5848151c0a55f473c34d01805490941683179093556036805460ff60a01b199093166001600160a81b031990931692909217600160a01b17909155915490516001600160a01b039190911691907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0908290a38015611166576000805461ff001916905550565b6000806000905061257b6037805461095e906133f2565b1561261a57834710156125de5760405162461bcd60e51b815260206004820152602560248201527f496e73756666696369656e74206e617469766520617373657420746f2072656c604482015264656173652160d81b606482015260840161023b565b6040516001600160a01b0388169085156108fc029086906000818181858888f19350505050158015612614573d6000803e3d6000fd5b5061277e565b6038868660405161262c929190612f79565b908152604051908190036020019020546001600160a01b03169050806126945760405162461bcd60e51b815260206004820152601960248201527f53796d626f6c206861736e277420726567697374657265642e00000000000000604482015260640161023b565b6040516370a0823160e01b815230600482015284906001600160a01b038316906370a082319060240160206040518083038186803b1580156126d557600080fd5b505afa1580156126e9573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061270d9190612f1b565b101561276a5760405162461bcd60e51b815260206004820152602660248201527f496e73756666696369656e7420746f6b656e2062616c616e636520746f2072656044820152656c656173652160d01b606482015260840161023b565b61277e6001600160a01b03821688866123b6565b61279483603e88886040516119cd929190612f79565b603e87876040516127a6929190612f79565b90815260405190819003602001902055905095945050505050565b6000612425828461328d565b6040516001600160a01b03808516602483015283166044820152606481018290526128059085906323b872dd60e01b906084016123e2565b50505050565b6001600160a01b03811661286f5760405162461bcd60e51b815260206004820152602560248201527f4343426173653a206e6577206f776e657220697320746865207a65726f206164604482015264647265737360d81b606482015260840161023b565b6033546040516001600160a01b038084169216907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e090600090a3603380546001600160a01b0319166001600160a01b0392909216919091179055565b6000612920826040518060400160405280602081526020017f5361666545524332303a206c6f772d6c6576656c2063616c6c206661696c6564815250856001600160a01b031661299d9092919063ffffffff16565b805190915015612358578080602001905181019061293e9190612d0a565b6123585760405162461bcd60e51b815260206004820152602a60248201527f5361666545524332303a204552433230206f7065726174696f6e20646964206e6044820152691bdd081cdd58d8d9595960b21b606482015260840161023b565b60606129ac84846000856129b4565b949350505050565b606082471015612a155760405162461bcd60e51b815260206004820152602660248201527f416464726573733a20696e73756666696369656e742062616c616e636520666f6044820152651c8818d85b1b60d21b606482015260840161023b565b6001600160a01b0385163b612a6c5760405162461bcd60e51b815260206004820152601d60248201527f416464726573733a2063616c6c20746f206e6f6e2d636f6e7472616374000000604482015260640161023b565b600080866001600160a01b03168587604051612a889190612f5d565b60006040518083038185875af1925050503d8060008114612ac5576040519150601f19603f3d011682016040523d82523d6000602084013e612aca565b606091505b5091509150612ada828286612ae5565b979650505050505050565b60608315612af4575081612425565b825115612b045782518084602001fd5b8160405162461bcd60e51b815260040161023b9190613127565b828054612b2a906133f2565b90600052602060002090601f016020900481019282612b4c5760008555612b92565b82601f10612b6557805160ff1916838001178555612b92565b82800160010185558215612b92579182015b82811115612b92578251825591602001919060010190612b77565b50612b9e929150612c16565b5090565b828054612bae906133f2565b90600052602060002090601f016020900481019282612bd05760008555612b92565b82601f10612be95782800160ff19823516178555612b92565b82800160010185558215612b92579182015b82811115612b92578235825591602001919060010190612bfb565b5b80821115612b9e5760008155600101612c17565b60008083601f840112612c3d57600080fd5b50813567ffffffffffffffff811115612c5557600080fd5b602083019150836020828501011115612c6d57600080fd5b9250929050565b600060208284031215612c8657600080fd5b813561242581613459565b60008060008060608587031215612ca757600080fd5b8435612cb281613459565b9350602085013567ffffffffffffffff811115612cce57600080fd5b612cda87828801612c2b565b9598909750949560400135949350505050565b600060208284031215612cff57600080fd5b81356124258161346e565b600060208284031215612d1c57600080fd5b81516124258161346e565b600080600080600080600060c0888a031215612d4257600080fd5b873596506020880135612d5481613459565b95506040880135612d6481613459565b9450606088013567ffffffffffffffff811115612d8057600080fd5b612d8c8a828b01612c2b565b989b979a50959895979660808701359660a0013595509350505050565b60008060008060008060a08789031215612dc257600080fd5b863595506020870135612dd481613459565b9450604087013567ffffffffffffffff811115612df057600080fd5b612dfc89828a01612c2b565b979a9699509760608101359660809091013595509350505050565b60008060208385031215612e2a57600080fd5b823567ffffffffffffffff811115612e4157600080fd5b612e4d85828601612c2b565b90969095509350505050565b60008060008060608587031215612e6f57600080fd5b843567ffffffffffffffff811115612e8657600080fd5b612e9287828801612c2b565b9095509350506020850135612ea681613459565b9396929550929360400135925050565b600080600060408486031215612ecb57600080fd5b833567ffffffffffffffff811115612ee257600080fd5b612eee86828701612c2b565b909790965060209590950135949350505050565b600060208284031215612f1457600080fd5b5035919050565b600060208284031215612f2d57600080fd5b5051919050565b81835281816020850137506000828201602090810191909152601f909101601f19169091010190565b60008251612f6f8184602087016133c6565b9190910192915050565b8183823760009101908152919050565b600080835481600182811c915080831680612fa557607f831692505b6020808410821415612fc557634e487b7160e01b86526022600452602486fd5b818015612fd95760018114612fea57613017565b60ff19861689528489019650613017565b60008a81526020902060005b8681101561300f5781548b820152908501908301612ff6565b505084890196505b509498975050505050505050565b6020808252825182820181905260009190848201906040850190845b818110156130665783516001600160a01b031683529284019291840191600101613041565b50909695505050505050565b606081526000613086606083018688612f34565b6001600160a01b03949094166020830152506040015292915050565b6080815260006130b6608083018789612f34565b6001600160a01b0395909516602083015250604081019290925260609091015292915050565b6060815260006130f0606083018688612f34565b6020830194909452506040015292915050565b604081526000613117604083018587612f34565b9050826020830152949350505050565b60208152600082518060208401526131468160408501602087016133c6565b601f01601f19169190910160400192915050565b60208082526017908201527f627573696e65737320737769746368206973206f666621000000000000000000604082015260600190565b60208082526022908201527f4343426173653a2063616c6c6572206973206e6f7420746865207769746e6573604082015261732160f01b606082015260800190565b6020808252602e908201527f496e697469616c697a61626c653a20636f6e747261637420697320616c72656160408201526d191e481a5b9a5d1a585b1a5e995960921b606082015260800190565b6020808252818101527f4343426173653a2063616c6c6572206973206e6f7420746865206f776e657221604082015260600190565b6020808252601f908201527f5265656e7472616e637947756172643a207265656e7472616e742063616c6c00604082015260600190565b600082198211156132a0576132a061342d565b500190565b600181815b808511156132e05781600019048211156132c6576132c661342d565b808516156132d357918102915b93841c93908002906132aa565b509250929050565b600061242583836000826132fe57506001610833565b8161330b57506000610833565b8160018114613321576002811461332b57613347565b6001915050610833565b60ff84111561333c5761333c61342d565b50506001821b610833565b5060208310610133831016604e8410600b841016171561336a575081810a610833565b61337483836132a5565b80600019048211156133885761338861342d565b029392505050565b60008160001904831182151516156133aa576133aa61342d565b500290565b6000828210156133c1576133c161342d565b500390565b60005b838110156133e15781810151838201526020016133c9565b838111156128055750506000910152565b600181811c9082168061340657607f821691505b6020821081141561342757634e487b7160e01b600052602260045260246000fd5b50919050565b634e487b7160e01b600052601160045260246000fd5b634e487b7160e01b600052603260045260246000fd5b6001600160a01b038116811461116657600080fd5b801515811461116657600080fdfea26469706673582212207d0b297bcbc5104ece496366c95ae8db61abb35aea2ff2d01671c2705405ef6364736f6c63430008070033'

result = contract.init(abi=abi, bytecode=bytecode, address=setting.source_ADDRESS)  # 有地址直接初始化，和部署二选一
account = Account.from_key(setting.source_contract_ower_prikey)
# assert account.address == setting.contract_ower_eip55
# account = Account.from_key(setting.contract_ower_prikey)
contract.set_default_account(account)

@allure.title("Source contract validation")
@pytest.mark.P1
def test_witness_001():
    print(contract.address)
    # result = contract.setTokenCap('USDT', 8000000000000000000000000001, txn={'gasPrice': 1000000000})
    #                               # , private_key=contract_ower_prikey)
    # print(result)

    # result = contract.regTokenContract('ETH01', '0xF23E463f10AcE2F5e0E668e2A5C5844e6491E355', 2000000000000000000, txn={'gasPrice': 1000000000})
    # # , private_key=contract_ower_prikey)
    # print(result)
    # result = contract.getTokenCap('ETH01')
    # print(result)

    # result = contract.setSingleMaxCap('USDTT22', 900000000000000000000000000,
    #                             txn={'gasPrice': 1000000000})
    # # , private_key=contract_ower_prikey)
    # print(result)
    #
    # result = contract.setSingleMinCap('USDTT22', 100000000000,
    #                             txn={'gasPrice': 1000000000})
    # # , private_key=contract_ower_prikey)
    # print(result)

    # account = Account.from_key(setting.contract_ower_prikey)
    # contract.set_default_account(account)
    # result = contract.lockAsset('0x68C45AEC85A2E1683a63C4EcD64dc0Ac66792f4d', 'USDTT22', 100000000000000, txn={'gasPrice': 1000000000})
    # , private_key=contract_ower_prikey)
    # print(result)



@allure.title("Source contract validation")
@pytest.mark.P1
def test_debug():
    # result = contract.regTokenContract('AUSDT1', '0xb50b7a285d3E6B14adb78ac492c0Cf73EF87FF7B', 2000000000000000000000000000,
    #                         txn={'gasPrice': 1000000000})
    # # # , private_key=contract_ower_prikey)
    # print(result)
    # result = contract.getTokenCap('AUSDT')
    # print(result)
    # result = contract.setSingleMaxCap('AUSDT', 2000000000000000000000000000, txn={'gasPrice': 1000000000})
    # print(result)
    # result = contract.setSingleMinCap('AUSDT', 1, txn={'gasPrice': 1000000000})
    # print(result)
    # result = contract.getSingleMaxCap('AUSDT')
    # print(result)
    # result = contract.getSingleMinCap('AUSDT')
    # print(result)

    # account = Account.from_key(token_prikey)
    # contract.set_default_account(account)
    #
    result = contract.lockAsset('0x6d795FD82391fEEeFBc3aeE3241496c07a575442', 'AUSDT', 100, txn={'gasPrice': 1000000000}
    , private_key=token_prikey
                                )
    print(result)
    # pass


def test_shingdebug():
    from platon import Web3, HTTPProvider

    w3 = Web3(HTTPProvider('https://devnetopenapi.platon.network/rpc'))

    print(w3.platon.chain_id)